{# Activity Summary Module Template #}
<div class="module-activity-summary">
    
    {# ===== SUMMARY STATISTICS ===== #}
    <div class="summary-section">
        <h4 class="section-title">{{ t.activity_overview | default('Activity Overview') }} ({{ event_group_name }})</h4>
        
        {% if stats.total_events > 0 %}
        <table class="data-table stats-table">
            <tbody>
                <tr>
                    <th>{{ t.activity_period | default('Activity Period') }}</th>
                    <td>{{ stats.earliest }} &rarr; {{ stats.latest }}</td>
                </tr>
                <tr>
                    <th>{{ t.duration | default('Duration') }}</th>
                    <td>{{ stats.span_days }} {{ t.days | default('days') }}</td>
                </tr>
                <tr>
                    <th>{{ t.total_events | default('Total Events') }}</th>
                    <td>{{ "{:,}".format(stats.total_events) }}</td>
                </tr>
                <tr>
                    <th>{{ t.avg_events_per_day | default('Average Events/Day') }}</th>
                    <td>{{ stats.avg_events_per_day }}</td>
                </tr>
            </tbody>
        </table>
        {% else %}
        <p class="empty-message">{{ t.no_timeline_events | default('No timeline events found for the selected filters.') }}</p>
        {% endif %}
    </div>

    {# ===== EVENT TYPE BREAKDOWN ===== #}
    {% if show_event_breakdown and event_breakdown %}
    <div class="event-breakdown-section">
        <h4 class="section-title">{{ t.events_by_type | default('Events by Type') }}</h4>
        <p class="section-description">{{ t.events_by_type_desc | default('This table shows the distribution of recorded events across different activity categories. Higher counts indicate more frequent activity in that category during the analysis period.') }}</p>
        <table class="breakdown-table">
            <thead>
                <tr>
                    <th>{{ t.event_type | default('Event Type') }}</th>
                    <th>{{ t.count | default('Count') }}</th>
                    <th>{{ t.percentage | default('Percentage') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for kind, count in event_breakdown.items() %}
                {% set percentage = (count / stats.total_events * 100) | round(1) %}
                <tr>
                    <td class="event-kind">{{ kind }}</td>
                    <td class="event-count">{{ "{:,}".format(count) }}</td>
                    <td class="event-percent">
                        <div class="percent-bar-container">
                            <div class="percent-bar" style="width: {{ percentage }}%;"></div>
                            <span class="percent-value">{{ percentage }}%</span>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {# ===== DAILY ACTIVITY BREAKDOWN ===== #}
    {% if show_daily and daily_counts %}
    <div class="daily-breakdown-section">
        <h4 class="section-title">{{ t.daily_activity | default('Daily Activity') }}</h4>
        <p class="section-description">{{ t.daily_activity_desc | default('Visual overview of system activity intensity per day. Longer bars indicate higher activity.') }}</p>
        <div class="daily-chart">
            <div class="chart-container">
                {% for day in daily_counts %}
                <div class="chart-bar-wrapper" title="{{ day.date }}: {{ day.count }} {{ t.events | default('events') }}">
                    <div class="chart-bar" style="height: {{ day.bar_height }}%;"></div>
                </div>
                {% endfor %}
            </div>
            <div class="chart-labels">
                <span class="chart-label-start">{{ daily_counts[0].date }}</span>
                <span class="chart-label-end">{{ daily_counts[-1].date }}</span>
            </div>
        </div>
        {% if daily_counts | length >= 60 %}
        <p class="truncation-note">{{ t.showing_first_days | default('Showing first') }} {{ daily_counts | length }} {{ t.days | default('days') }}</p>
        {% endif %}
    </div>
    {% endif %}

    {# ===== INACTIVITY GAPS ===== #}
    {% if gaps %}
    <div class="gaps-section">
        <h4 class="section-title">{{ t.inactivity_gaps | default('Significant Inactivity Gaps') }} (&gt;{{ min_gap_hours }}h)</h4>
        <table class="gaps-table">
            <thead>
                <tr>
                    <th>{{ t.from | default('From') }}</th>
                    <th>{{ t.to | default('To') }}</th>
                    <th>{{ t.duration | default('Duration') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for gap in gaps %}
                <tr>
                    <td class="gap-start">{{ gap.start }}</td>
                    <td class="gap-end">{{ gap.end }}</td>
                    <td class="gap-duration">{{ gap.duration_display }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif stats.total_events > 0 %}
    <div class="gaps-section">
        <h4 class="section-title">{{ t.inactivity_gaps | default('Significant Inactivity Gaps') }} (&gt;{{ min_gap_hours }}h)</h4>
        <p class="no-gaps-message">{{ t.no_gaps_found | default('No significant inactivity gaps found') }} (&lt; {{ min_gap_hours }} {{ t.hours | default('hours') }}).</p>
    </div>
    {% endif %}

</div>

<style>
.module-activity-summary {
    margin: 1em 0;
}

.module-activity-summary h4 {
    margin: 0 0 0.5em 0;
    color: #333;
    border-bottom: 1px solid #ddd;
    padding-bottom: 0.3em;
}

.module-activity-summary .section-title {
    margin-top: 1.5em;
}

/* Summary section */
.summary-section {
    margin-bottom: 1em;
}

.section-description {
    color: #666;
    font-size: 0.9em;
    margin: 0.3em 0 0.8em 0;
}

.stats-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0.5em;
}

.stats-table th,
.stats-table td {
    padding: 0.4em 0.5em;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.stats-table th {
    background: #f5f5f5;
    font-weight: 500;
    width: 200px;
}

/* Breakdown table */
.breakdown-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0.5em;
}

.breakdown-table th,
.breakdown-table td {
    padding: 0.4em 0.5em;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.breakdown-table th {
    background: #f5f5f5;
    font-weight: 500;
}

.percent-bar-container {
    display: flex;
    align-items: center;
    width: 100%;
}

.percent-bar {
    height: 12px;
    background: #4a90d9;
    border-radius: 2px;
    min-width: 2px;
}

.percent-value {
    margin-left: 0.5em;
    font-size: 0.85em;
    color: #666;
}

/* Daily activity compact chart */
.daily-chart {
    margin-top: 0.5em;
}

.chart-container {
    display: flex;
    align-items: flex-end;
    height: 60px;
    gap: 1px;
    background: #f8f8f8;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    padding: 4px;
}

.chart-bar-wrapper {
    flex: 1;
    height: 100%;
    display: flex;
    align-items: flex-end;
    min-width: 2px;
    background: #f0f0f0;
}

.chart-bar {
    width: 100%;
    background: linear-gradient(180deg, #4a90d9 0%, #357abd 100%);
    border-radius: 1px 1px 0 0;
    min-height: 4px;
    transition: opacity 0.2s;
}

.chart-bar-wrapper:hover .chart-bar {
    opacity: 0.7;
}

.chart-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 0.3em;
    font-size: 0.8em;
    color: #666;
    font-family: monospace;
}

/* Gaps table */
.gaps-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0.5em;
}

.gaps-table th,
.gaps-table td {
    padding: 0.4em 0.5em;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.gaps-table th {
    background: #f5f5f5;
    font-weight: 500;
}

.gaps-table .gap-duration {
    font-weight: 500;
    color: #c0392b;
}

/* Messages */
.empty-message,
.no-gaps-message {
    color: #666;
    font-style: italic;
    margin: 0.5em 0;
}

.truncation-note {
    color: #888;
    font-size: 0.9em;
    font-style: italic;
    margin-top: 0.5em;
}
</style>
