{# URL Summary Module Template #}
<div class="module-url-summary{% if shorten_urls %} shorten-urls{% endif %}">
    {% if section_title %}
    <h3 class="module-title">{{ section_title }}</h3>
    {% endif %}
    {% if group_by_domain and grouped_data %}
    {# ===== GROUPED VIEW ===== #}
    {% set grouped_cols = 3 + (2 if show_dates else 0) %}
    <table class="url-summary-table grouped">
        <thead>
            <tr>
                <th class="col-domain">{{ t.domain | default('Domain') }}</th>
                <th class="col-url-count">{{ t.urls | default('URLs') }}</th>
                <th class="col-occurrences">{{ t.occurrences | default('Occurrences') }}</th>
                {% if show_dates %}
                <th class="col-first-seen">{{ t.first_seen | default('First Seen') }}</th>
                <th class="col-last-seen">{{ t.last_seen | default('Last Seen') }}</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for group in grouped_data %}
            {# Domain header row #}
            <tr class="domain-row">
                <td class="col-domain">{{ group.domain }}</td>
                <td class="col-url-count">{{ group.total_urls }}</td>
                <td class="col-occurrences">{{ group.total_occurrences }}</td>
                {% if show_dates %}
                <td class="col-first-seen">{{ group.first_seen or '' }}</td>
                <td class="col-last-seen">{{ group.last_seen or '' }}</td>
                {% endif %}
            </tr>
            {# Sub-URL rows #}
            {% for url in group.shown_urls %}
            <tr class="sub-url-row">
                <td class="col-sub-url" colspan="{{ grouped_cols }}">{{ url.url }}</td>
            </tr>
            {% endfor %}
            {% if group.hidden_count > 0 %}
            <tr class="sub-url-row more-row">
                <td class="col-sub-url" colspan="{{ grouped_cols }}">
                    <span class="more-indicator">... {{ t.and_more | default('and') }} {{ group.hidden_count }} {{ t.more_urls | default('more URLs') }}</span>
                </td>
            </tr>
            {% endif %}
            {% else %}
            <tr>
                <td colspan="{{ grouped_cols }}" class="empty-message">{{ t.no_urls_found | default('No URLs found matching the filter criteria.') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if show_filter_info %}
    <p class="filter-info">
        <strong>{{ t.filter | default('Filter') }}:</strong> {{ filter_description }} 
        <span class="url-count">({{ total_domains }} {{ t.domains | default('domains') }}, {{ total_count }} {{ t.distinct_urls | default('distinct URLs') }})</span>
    </p>
    {% endif %}
    
    {% else %}
    {# ===== FLAT VIEW ===== #}
    {% set flat_cols = 2 + (2 if show_dates else 0) %}
    <table class="url-summary-table">
        <thead>
            <tr>
                <th class="col-url">{{ t.url | default('URL') }}</th>
                <th class="col-occurrences">{{ t.occurrences | default('Occurrences') }}</th>
                {% if show_dates %}
                <th class="col-first-seen">{{ t.first_seen | default('First Seen') }}</th>
                <th class="col-last-seen">{{ t.last_seen | default('Last Seen') }}</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for url in urls %}
            <tr>
                <td class="col-url">{{ url.url }}</td>
                <td class="col-occurrences">{{ url.occurrences }}</td>
                {% if show_dates %}
                <td class="col-first-seen">{{ url.first_seen or '' }}</td>
                <td class="col-last-seen">{{ url.last_seen or '' }}</td>
                {% endif %}
            </tr>
            {% else %}
            <tr>
                <td colspan="{{ flat_cols }}" class="empty-message">{{ t.no_urls_found | default('No URLs found matching the filter criteria.') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if show_filter_info %}
    <p class="filter-info">
        <strong>{{ t.filter | default('Filter') }}:</strong> {{ filter_description }} 
        <span class="url-count">({{ total_count }} {{ t.distinct_urls | default('distinct URLs') }})</span>
    </p>
    {% endif %}
    {% endif %}
</div>

<style>
.module-url-summary {
    margin: 1em 0;
}

.module-url-summary .module-title {
    margin: 0 0 0.5em 0;
    font-size: 1.1em;
    font-weight: 600;
    color: #333;
}

.module-url-summary .filter-info {
    margin-top: 0.5em;
    color: #555;
    font-size: 0.9em;
}

.module-url-summary .url-count {
    color: #888;
}

.url-summary-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85em;
    table-layout: fixed;
}

.url-summary-table th,
.url-summary-table td {
    border: 1px solid #ddd;
    padding: 4px 6px;
    text-align: left;
    overflow: hidden;
    text-overflow: ellipsis;
}

.url-summary-table th {
    background-color: #f5f5f5;
    font-weight: 600;
}

.url-summary-table tbody tr:hover {
    background-color: #f0f7ff;
}

.url-summary-table .col-url {
    word-break: break-all;
    word-wrap: break-word;
}

/* Shorten URLs mode - truncate to single line */
.module-url-summary.shorten-urls .url-summary-table .col-url,
.module-url-summary.shorten-urls .url-summary-table .col-sub-url {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    word-break: normal;
    word-wrap: normal;
}

.url-summary-table .col-occurrences,
.url-summary-table .col-url-count {
    text-align: center;
    width: 90px;
}

.url-summary-table .col-first-seen,
.url-summary-table .col-last-seen {
    width: 100px;
    font-size: 0.8em;
}

.url-summary-table .empty-message {
    text-align: center;
    color: #888;
    font-style: italic;
    padding: 20px;
}

/* Grouped view styles */
.url-summary-table.grouped .domain-row {
    background-color: #f8f9fa;
    font-weight: 600;
}

.url-summary-table.grouped .domain-row td {
    border-bottom: none;
}

.url-summary-table.grouped .col-domain {
    word-break: break-all;
    word-wrap: break-word;
}

.url-summary-table.grouped .sub-url-row {
    background-color: #ffffff;
}

.url-summary-table.grouped .sub-url-row td {
    border-top: none;
    padding-top: 2px;
    padding-bottom: 2px;
}

.url-summary-table.grouped .sub-url-row:last-of-type td,
.url-summary-table.grouped .more-row td {
    border-bottom: 1px solid #ddd;
}

.url-summary-table.grouped .col-sub-url {
    padding-left: 20px;
    color: #333;
    font-size: 0.95em;
    word-break: break-all;
}

.url-summary-table.grouped .more-indicator {
    color: #888;
    font-style: italic;
    font-size: 0.9em;
}
</style>
